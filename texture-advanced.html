<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ­Ù„ÙŠÙ„ Ù†Ø³ÙŠØ¬ Ø§Ù„ÙˆØ±Ù‚ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f0f4f8;
      text-align: center;
      padding: 20px;
      direction: rtl;
    }
    canvas {
      border: 2px solid #ccc;
      margin-top: 20px;
    }
    button {
      font-size: 18px;
      padding: 10px 25px;
      background-color: #0275d8;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      color: #333;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“¸ ØªØµÙˆÙŠØ± Ù…Ø¨Ø§Ø´Ø± ÙˆØªØ­Ù„ÙŠÙ„ Ù†Ø³ÙŠØ¬ ÙˆØ±Ù‚ÙŠ Ø¯Ù‚ÙŠÙ‚</h2>
  <button onclick="captureComparison()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØ±</button>
  <canvas id="compareCanvas" width="500" height="250"></canvas>
  <div id="result">ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙˆÙŠØ±...</div>

  <script>
    function captureComparison() {
      const canvas = document.getElementById('compareCanvas');
      const ctx = canvas.getContext('2d');
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„...';

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          const video = document.createElement('video');
          video.srcObject = stream;
          video.play();

          video.onloadeddata = () => {
            // ØªØµÙˆÙŠØ± Ù…Ù†Ø·Ù‚ØªÙŠÙ† Ù…Ù†ÙØµÙ„ØªÙŠÙ†
            ctx.drawImage(video, 80, 120, 200, 200, 0, 0, 200, 200);   // Ø§Ù„ÙˆØ±Ù‚Ø© A
            ctx.drawImage(video, 320, 120, 200, 200, 300, 0, 200, 200); // Ø§Ù„ÙˆØ±Ù‚Ø© B
            stream.getTracks().forEach(track => track.stop());

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ±Ø©
            const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const grayData = [];

            for (let i = 0; i < imgData.data.length; i += 4) {
              const r = imgData.data[i];
              const g = imgData.data[i + 1];
              const b = imgData.data[i + 2];
              const gray = Math.round(0.299 * r + 0.587 * g + 0.114 * b);
              grayData.push(gray);
            }

            // ÙØµÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ØªÙŠÙ†
            const patchA = grayData.slice(0, 200 * 200);
            const patchB = grayData.slice(200 * 200, 400 * 200);
            const similarity = compareTexture(patchA, patchB);

            resultDiv.textContent = `âœ… Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù†Ø³ÙŠØ¬ÙŠ: ${similarity.toFixed(2)}Ùª`;
          };
        })
        .catch(error => {
          resultDiv.textContent = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ${error.message}`;
        });
    }

    function compareTexture(a, b) {
      let sumDiff = 0;
      for (let i = 0; i < a.length; i++) {
        sumDiff += Math.abs(a[i] - b[i]);
      }
      const avgDiff = sumDiff / a.length;
      const similarity = 100 - ((avgDiff / 255) * 100); // Ù†Ø³Ø¨Ø© Ø¹ÙƒØ³ÙŠØ©
      return similarity;
    }
  </script>
</body>
</html>
