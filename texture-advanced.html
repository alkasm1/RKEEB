<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø³ÙŠØ¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; direction: rtl; text-align: center; background: #f4f4f4; padding: 20px; }
    h1 { color: #444; }
    input, progress { margin: 15px; padding: 10px; font-size: 1rem; }
    #resultMessage { margin-top: 20px; font-size: 1.2rem; color: #333; }
    button { padding: 10px 20px; font-size: 1rem; background: #2e86de; color: white; border: none; cursor: pointer; border-radius: 5px; }
    button:hover { background: #1e5f9c; }
  </style>
</head>
<body>
  <h1>ğŸ” ØµÙØ­Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø³ÙŠØ¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
  <input type="file" accept="image/*" id="imageInput">
  <button onclick="startAnalysis()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
  <progress id="matchProgress" value="0" max="100"></progress>
  <div id="resultMessage">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©</div>

  <script>
    async function analyzeSingleImage(file) {
      const result = document.getElementById('resultMessage');
      const progress = document.getElementById('matchProgress');

      if (!file) {
        result.innerText = "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø§Ù„Ø£ØµÙ„ ÙˆØ§Ù„Ù…ÙØ´ØªØ¨Ù‡ Ø¨Ù‡ Ù…Ø¹Ù‹Ø§";
        return;
      }

      result.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";

      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.src = reader.result;

        img.onload = async () => {
          const canvasLeft = document.createElement("canvas");
          const canvasRight = document.createElement("canvas");

          const halfWidth = img.width / 2;
          const height = img.height;

          [canvasLeft, canvasRight].forEach(c => {
            c.width = 300;
            c.height = 300;
          });

          const ctxLeft = canvasLeft.getContext("2d");
          const ctxRight = canvasRight.getContext("2d");

          ctxLeft.drawImage(img, 0, 0, halfWidth, height, 0, 0, 300, 300);
          ctxRight.drawImage(img, halfWidth, 0, halfWidth, height, 0, 0, 300, 300);

          const materialMatch = evaluateMaterialMatch(canvasLeft, canvasRight);
          if (materialMatch < 80) {
            result.innerText = `âŒ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© (${materialMatch}%) - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ù‚Ø§Ø±Ù†Ø© Ù…ÙˆØ«ÙˆÙ‚Ø©`;
            progress.value = materialMatch;
            return;
          }

          const blobLeft = await new Promise(res => canvasLeft.toBlob(res, 'image/png'));
          const blobRight = await new Promise(res => canvasRight.toBlob(res, 'image/png'));

          const hashLeft = await calculateHash(blobLeft);
          const hashRight = await calculateHash(blobRight);

          const percent = calculateSimilarity(hashLeft, hashRight);
          progress.value = percent;

          if (percent >= 90) result.innerText = `âœ… ØªØ·Ø§Ø¨Ù‚ ${percent}% - Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ù‹Ø§`;
          else if (percent >= 70) result.innerText = `âš ï¸ ØªØ·Ø§Ø¨Ù‚ ${percent}% - ØªØ­Ù‚Ù‚ ÙŠØ¯ÙˆÙŠ`;
          else result.innerText = `âŒ ØªØ·Ø§Ø¨Ù‚ ${percent}% - Ù…Ø­ØªÙ…Ù„ ØªØ²ÙˆÙŠØ±`;
        };
      };
      reader.readAsDataURL(file);
    }

    function startAnalysis() {
      const input = document.getElementById('imageInput');
      analyzeSingleImage(input.files[0]);
    }

    // Ø¯ÙˆØ§Ù„ Ù…Ø­Ø§ÙƒØ§Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: replace with actual logic
    function evaluateMaterialMatch(c1, c2) {
      return Math.floor(Math.random() * 40) + 60; // Ù†Ø³Ø¨Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨ÙŠÙ† 60 Ùˆ100
    }

    async function calculateHash(blob) {
      const buffer = await blob.arrayBuffer();
      const hashBuffer = await crypto.subtle.digest("SHA-256", buffer);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function calculateSimilarity(hash1, hash2) {
      let matches = 0;
      for (let i = 0; i < Math.min(hash1.length, hash2.length); i++) {
        if (hash1[i] === hash2[i]) matches++;
      }
      return Math.round((matches / hash1.length) * 100);
    }
  </script>
</body>
</html>
